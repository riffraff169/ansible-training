SHELL = /bin/bash

all: venv

venv: venv/bin/activate

generate-requirements: clean requirements-base.txt
	test -d venv || python -m venv venv --system-site-packages
	venv/bin/python venv/bin/pip install pip==22.1.0
	venv/bin/python venv/bin/pip install setuptools==41.4.0
	venv/bin/python venv/bin/pip install -r requirements-base.txt
	echo "# Autogenerated file, do not modify; see requirements-base.txt" > requirements.txt
	venv/bin/python venv/bin/pip freeze >> requirements.txt

venv/bin/activate: requirements.txt
	if [ -d venv]; then \
		python -m venv venv --system-site-packages; \
	fi
	. venv/bin/activate; pip install -U pip; pip install -r requirements.txt

clean:
	$(RM) -rf venv
